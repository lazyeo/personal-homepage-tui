---
interface Props {
  currentTheme?: string;
}

const { currentTheme = 'gruvbox' } = Astro.props;

const themes = [
  { id: 'gruvbox', label: 'Gruvbox' },
  { id: 'frost', label: 'Frost' },
  { id: 'amber', label: 'Amber' },
];
---

<div class="theme-switcher" role="group" aria-label="Theme switcher">
  <button
    class="sound-toggle"
    id="sound-toggle"
    data-enabled="true"
    aria-label="Mute sounds"
    title="Toggle sound"
  >â™ª</button>
  {themes.map((theme) => (
    <button
      class={`theme-switcher__dot theme-switcher__dot--${theme.id}`}
      data-theme-id={theme.id}
      data-active={theme.id === currentTheme ? 'true' : 'false'}
      aria-label={`Switch to ${theme.label} theme`}
      title={theme.label}
    />
  ))}
</div>

<script>
  import { initSound, toggleSound } from '../scripts/sound.js';

  function initThemeSwitcher() {
    const dots = document.querySelectorAll('.theme-switcher__dot');
    const soundBtn = document.getElementById('sound-toggle');

    // Initialize sound system
    initSound();

    // Sound toggle button
    soundBtn?.addEventListener('click', toggleSound);

    // Update active state based on current theme
    function updateActiveDot() {
      const currentTheme = document.documentElement.getAttribute('data-theme') || 'gruvbox';
      dots.forEach(dot => {
        const isActive = dot.getAttribute('data-theme-id') === currentTheme;
        dot.setAttribute('data-active', isActive ? 'true' : 'false');
      });
    }

    dots.forEach(dot => {
      dot.addEventListener('click', () => {
        const themeId = dot.getAttribute('data-theme-id');
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'gruvbox';

        if (themeId && themeId !== currentTheme) {
          document.documentElement.setAttribute('data-theme', themeId);
          localStorage.setItem('theme', themeId);
          updateActiveDot();
        }
      });
    });

    // Initial update
    updateActiveDot();
  }

  // Run on page load
  initThemeSwitcher();

  // Re-run after Astro page transitions
  document.addEventListener('astro:page-load', initThemeSwitcher);
</script>
